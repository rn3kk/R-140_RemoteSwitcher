<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <input type="checkbox" name="cb1" id="check1" value="1" checked />
    <input type="checkbox" name="cb2" id="check2" value="2" />
    <input type="checkbox" name="cb3" id="check3" value="3" />


    <script type="text/JavaScript">


        function receiveGPIOState(jsonState) {
            var now = new Date();
            var result = jsonState.result;
            if (result == "true") {
              console.log("receiveGPIOState is OK");
            }
            else {
              console.log("receiveGPIOState is ERROR");
            }
            console.log(now)
            for (var i = 0; i < jsonState.pinsOutput.length; i++) {
                var pin = jsonState.pinsOutput[i]
                //console.log(pin.name);
            }
            console.log('\n')
            for (var i = 0; i < jsonState.pinsInput.length; i++) {
                var pin = jsonState.pinsInput[i]
              //  console.log(pin.name);
            }
            console.log('\n')
        };

        function changeGPIOState(json) {
          var result = json.result
          if (result == "true") {
            console.log("changeGPIOState is OK");
          }
          else {
            console.log("changeGPIOState is ERROR");
          }
        }

        var socket = new WebSocket("ws://127.0.0.1:8080/data");
        function checkWebSocket() {
            console.log("page load")
        };

        socket.onopen = function() {
            console.log("Соединение установлено.");
        };

        socket.onclose = function(event) {
            if (event.wasClean) {
                 console.log('Соединение закрыто чисто');
            } else {
                 console.log('Обрыв соединения'); // например, "убит" процесс сервера
            }
            console.log('Код: ' + event.code + ' причина: ' + event.reason);
        };

        socket.onmessage = function(event) {
            console.log("receive message");
            var blob = event.data;

            var reader = new FileReader();
            var jsonObj = null;
            reader.onloadend = function() {
              jsonObj = JSON.parse(reader.result)
              if(jsonObj != null) {
                var requestType = jsonObj.type
                if (requestType == "getGpioState") {
                  receiveGPIOState(jsonObj);
                }
                else if(requestType == "changeGpioState") {
                  changeGPIOState(jsonObj);
                }
              }
              else {
                console.log("json null");
              }
            }
            reader.readAsBinaryString(blob);
        };

        socket.onerror = function(error) {
            console.log("Ошибка " + error.message);
        };

        window.onload = checkWebSocket

        function gpioState(){
          var jsonRequestStr = {"request":"getGpioState"};
          var strJson = JSON.stringify(jsonRequestStr);
          socket.send(strJson);
        }
        setInterval("gpioState()",2000);

        function change_but(){
          document.getElementById('test_but').onclick=function(){
            var jsonRequestStr = {"request":"changeGpioState", "name":"10m"};
            var strJson = JSON.stringify(jsonRequestStr);
            socket.send(strJson);
          }
        }

    </script>
    <input type='button' value='Change' onClick="change_but()" id='test_but'>
</head>
<body>


</body>
</html>